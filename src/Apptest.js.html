import React, { useState, useEffect } from "react";
import axios from "axios";
import './App.css'

function App() {
  const [brands, setBrands] = useState([]);
  const [selectedBrand, setSelectedBrand] = useState('');
  const [qty, setQty] = useState(0);
  const [isWholePack, setIsWholePack] = useState(false);

  useEffect(() => {
    // Carga las marcas desde el backend al montar el componente
    axios.get('/brands')
      .then(response => {
        setBrands(response.data);
      })
      .catch(error => {
        console.error("Error al cargar las marcas:", error);
      });
  }, []);

  function getBrandCigarCount() {
    const brand = brands.find(b => b.name === selectedBrand);
    return brand ? brand.cigarCount : 0;
  }

  function calculation() {
    let quantity = parseInt(qty, 10);
    if (isNaN(quantity) || quantity < 0) {
      quantity = 0;
    }
    return isWholePack ? quantity + getBrandCigarCount() : quantity;
  }

  function handleSubmit() {
    const data = {
      brand: selectedBrand,
      quantity: calculation()
    };

    axios.post('/submit', data)
      .then(response => {
        alert(`Datos enviados con Ã©xito: ${data.quantity} de ${data.brand}`);
      })
      .catch(error => {
        alert("Error al enviar los datos.");
        console.error(error);
      });
  }

  function tobaccoPacketDetail() {
    const totalCigarros = calculation();
    return `${totalCigarros} Cigarros de ${selectedBrand}`;
  }

  return (
    <div className="container">
      <div className="alert alert-primary" role="alert">
        <img src="https://www.seranil.com/images/web/logo-seranil.png" alt="logo" width="300px" height="130px"></img>
        <h1>Inventorio de tabaco</h1>
      </div>
      <div className="form-group-2">
        <h3>Cantidad de cigarros:</h3>
        <input
          type="number"
          className="form"
          placeholder="Introduzca la cantidad"
          onChange={(event) => {
            const value = parseInt(event.target.value, 10);
            if (!isNaN(value) && value >= 0) {
              setQty(value);
            }
          }}
        />
      </div>
      <div>
        <h3>Paquete de tabaco:</h3>
        <select
          className="form-control"
          value={selectedBrand}
          onChange={(event) => { setSelectedBrand(event.target.value); }}>
          <option value="">Seleccionar...</option>
          {brands.map(brand => (
            <option key={brand.name} value={brand.name}>{brand.name}</option>
          ))}
        </select>
      </div>

<div className="checkbox">
        <input
          type="checkbox"
          id="paqueteentero"
          name="paqueteentero"
          checked={isWholePack}
          onChange={() => setIsWholePack(!isWholePack)}
        />
        <label htmlFor="paqueteentero"> Paquete entero</label>
      </div>

      <div className="form-group">
       

      <div className="alert alert-danger" role="alert">
        <h3><b>Cantidad de cigarros:</b> {calculation()}<br />
          <b>Marca y paquete: </b>  {selects} <br /></h3>
      </div>

      <div className="alert alert-success" role="alert">
        <label>El paciente tiene: </label>
        <h3 className="totalpaquetedetabaco">{paquetedetabaco()}</h3>
      </div>

      <button className="btn btn-primary" onClick={handleSubmit}>Enviar</button>
    </div>
    
  );
};

export default App;
